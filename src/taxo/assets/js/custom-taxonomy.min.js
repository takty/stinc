(e=>{const{i18n:{__:t},data:{withSelect:n,withDispatch:s},components:{CheckboxControl:o,RadioControl:i,withSpokenMessages:r},compose:{withInstanceId:a,compose:c},element:{Component:l,createElement:m},url:{addQueryArgs:h},apiFetch:u}=e,d=m;const p=c([n(((e,{slug:t})=>{const n=e("core").getTaxonomy(t);if(!n)return{hasAssignAction:!1,terms:[],taxonomy:n,isExclusive:!1};const s="undefined"==typeof wpinc_custom_taxonomy_exclusive?null:wpinc_custom_taxonomy_exclusive,o=s&&("*"===s||s.includes(t)),{getCurrentPost:i,getEditedPostAttribute:r}=e("core/editor");return{hasAssignAction:(a=i(),c=["_links",`wp:action-assign-${n.rest_base}`],l=!1,m=f(a,y(c)),_.isUndefined(m)?l:m),terms:r(n.rest_base),taxonomy:n,isExclusive:o};var a,c,l,m})),s((e=>({onUpdateTerms(t,n){e("core/editor").editPost({[n]:t})}}))),r,a])(class extends l{constructor(){super(...arguments),this.onChange=this.onChange.bind(this),this.state={availableTermsTree:[]}}onChange(e){const{onUpdateTerms:t,taxonomy:n,terms:s,isExclusive:o}=this.props;if(o)t([e],n.rest_base);else{t(s.includes(e)?_.without(s,e):[...s,e],n.rest_base)}}onClear(){const{onUpdateTerms:e,taxonomy:t}=this.props;e([],t.rest_base)}componentDidMount(){this.fetchTerms()}componentWillUnmount(){_.invoke(this.fetchRequest,["abort"])}componentDidUpdate(e){this.props.taxonomy!==e.taxonomy&&this.fetchTerms()}fetchTerms(){const{taxonomy:e}=this.props;e&&(this.fetchRequest=u({path:h(`/wp/v2/${e.rest_base}`,{per_page:-1,orderby:"name",order:"asc",_fields:"id,name,parent"})}),this.fetchRequest.then((e=>{this.fetchRequest=null,this.setState({availableTermsTree:x(e)})}),(e=>{"abort"!==e.statusText&&(this.fetchRequest=null)})))}render(){const{hasAssignAction:e,taxonomy:n}=this.props;return e?d("div",{className:"editor-post-taxonomies__hierarchical-terms-list"+(n.hierarchical?"":" non-hierarchical"),key:"term-list",tabIndex:"0",role:"group",ariaLabel:n.name??t("Terms")},this.renderTerms(this.state.availableTermsTree)):null}renderTerms(e){const{terms:t=[],taxonomy:n,isExclusive:s}=this.props;return e.map((e=>{const o=-1!==t.indexOf(e.id)||!t.length&&e.id===n.default_term?e.id:0,i=this.createComponent(e,o,s);return d("div",{className:"editor-post-taxonomies__hierarchical-terms-choice",key:e.id},[i,e.children.length?d("div",{className:"editor-post-taxonomies__hierarchical-terms-subchoices"},this.renderTerms(e.children)):null])}))}createComponent(e,t,n){return n?d(i,{options:[{label:e.name,value:e.id}],selected:t,onChange:()=>{this.onChange(parseInt(e.id,10))}}):d(o,{label:e.name,checked:t,onChange:()=>{this.onChange(parseInt(e.id,10))}})}});function x(e){const t=e.map((e=>({...e,children:[]}))),n=_.groupBy(t,"parent");if(n[void 0]&&n[void 0].length)return t;const s=e=>e.map((e=>{const t=n[e.id]??[];return{...e,children:t.length?s(t):t}}));return s(n[0]||[])}function y(e){return Array.isArray(e)?e:[e]}function f(e,t){for(var n=t.length,s=0;s<n;s++){if(null==e)return;e=e[t[s]]}return n?e:void 0}e.hooks.addFilter("editor.PostTaxonomyType","custom-taxonomy",(function(t){const n="undefined"==typeof wpinc_custom_taxonomy_inclusive?null:wpinc_custom_taxonomy_inclusive,s="undefined"==typeof wpinc_custom_taxonomy_exclusive?null:wpinc_custom_taxonomy_exclusive;return function(o){const i=o.slug;return n&&("*"===n||n.includes(i))||s&&("*"===s||s.includes(i))?e.element.createElement(p,o):e.element.createElement(t,o)}}))})(window.wp);
//# sourceMappingURL=custom-taxonomy.min.js.map