{"version":3,"sources":["assets/lib/picker-media.js"],"names":["window","wpinc","dia","setMediaPicker","elm","cls","fn","opts","Object","assign","multiple","type","parentGen","title","postId","document","getElementById","value","cm","addEventListener","e","preventDefault","wp","media","view","AttachmentsBrowser","AttachmentsBrowserCustom","model","settings","post","id","library","frame","uploader","options","params","post_id","createMedia","target","innerText","on","p","getParent","fileJsons","state","get","map","f","toJSON","setItem","fileJson","first","sel","mid","at","attachment","fetch","add","AttachmentsBrowserOrig","open","MediaLibraryUploadedFilter","AttachmentFilters","extend","createFilters","filters","all","text","l10n","allMediaItems","props","status","uploadedTo","orderby","order","priority","uploaded","uploadedToThisPost","unattached","this","createToolbar","prototype","call","toolbar","set","controller","collection","render"],"mappings":"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","file":"assets\\lib\\picker-media.min.js","sourcesContent":["/**\n * Media Picker\n *\n * @author Takuto Yanagida\n * @version 2023-02-10\n */\n\nwindow.wpinc     = window.wpinc ?? {}\nwindow.wpinc.dia = window.wpinc.dia ?? {}\n\nwindow.wpinc.dia.setMediaPicker = function (elm, cls = false, fn = null, opts = {}) {\n\tif (cls === false) cls = 'media';\n\topts = Object.assign({ multiple: false, type: '', parentGen: -1, title: false }, opts);\n\n\tconst postId = document.getElementById('post_ID').value;\n\tlet cm = null;\n\telm.addEventListener('click', e => {\n\t\te.preventDefault();\n\t\tif (!cm) {\n\t\t\twp.media.view.AttachmentsBrowser = AttachmentsBrowserCustom;\n\t\t\tcm = createMedia(postId, opts.title === false ? e.target.innerText : opts.title, opts.multiple, opts.type);\n\t\t\tcm.on('select', () => {\n\t\t\t\tconst p = (parentGen !== -1) ? getParent(e.target, opts.parentGen) : null;\n\n\t\t\t\tif (opts.multiple) {\n\t\t\t\t\tconst fs        = cm.state().get('selection');\n\t\t\t\t\tconst fileJsons = fs.map((f) => f.toJSON());\n\t\t\t\t\tif (p) setItem(p, cls, fileJsons[0]);\n\t\t\t\t\tif (fn) fn(e.target, fileJsons);\n\t\t\t\t} else {\n\t\t\t\t\tconst f        = cm.state().get('selection').first();\n\t\t\t\t\tconst fileJson = f.toJSON();\n\t\t\t\t\tif (p) setItem(p, cls, fileJson);\n\t\t\t\t\tif (fn) fn(e.target, fileJson);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (opts['media_id_input']) {\n\t\t\t\tcm.on('open', () => {\n\t\t\t\t\tconst sel = cm.state().get('selection');\n\t\t\t\t\tconst mid = document.getElementById(opts['media_id_input']).value;\n\t\t\t\t\tconst at = wp.media.attachment(mid);\n\t\t\t\t\tat.fetch();\n\t\t\t\t\tsel.add(at ? [at] : []);\n\t\t\t\t});\n\t\t\t}\n\t\t\tcm.on('close', () => {\n\t\t\t\twp.media.view.AttachmentsBrowser = AttachmentsBrowserOrig;\n\t\t\t});\n\t\t}\n\t\tcm.open();\n\t});\n\n\tfunction createMedia(postId, title, multiple, type) {\n\t\twp.media.model.settings.post.id = postId;\n\t\twp.media.view.settings.post.id  = postId;\n\n\t\tconst media = wp.media({\n\t\t\ttitle   : title,\n\t\t\tlibrary : {type: type},\n\t\t\tframe   : 'select',\n\t\t\tmultiple: multiple,\n\t\t});\n\t\t// For attaching uploaded file to post\n\t\tmedia.uploader.options.uploader.params.post_id = postId;\n\t\treturn media;\n\t}\n\n\t/*\n\t * Tha following enables our media picker selectable 'Uploaded to this post'.\n\t * https://cobbledco.de/adding-your-own-filter-to-the-media-uploader/\n\t */\n\tconst MediaLibraryUploadedFilter = wp.media.view.AttachmentFilters.extend({\n\t\tcreateFilters: function() {\n\t\t\tconst filters = {};\n\t\t\tfilters.all = {\n\t\t\t\ttext:  wp.media.view.l10n.allMediaItems,\n\t\t\t\tprops: {\n\t\t\t\t\tstatus    : null,\n\t\t\t\t\ttype      : null,\n\t\t\t\t\tuploadedTo: null,\n\t\t\t\t\torderby   : 'date',\n\t\t\t\t\torder     : 'DESC'\n\t\t\t\t},\n\t\t\t\tpriority: 10\n\t\t\t};\n\t\t\tfilters.uploaded = {\n\t\t\t\ttext:  wp.media.view.l10n.uploadedToThisPost,\n\t\t\t\tprops: {\n\t\t\t\t\tstatus    : null,\n\t\t\t\t\ttype      : null,\n\t\t\t\t\tuploadedTo: wp.media.view.settings.post.id,\n\t\t\t\t\torderby   : 'menuOrder',\n\t\t\t\t\torder     : 'ASC'\n\t\t\t\t},\n\t\t\t\tpriority: 20\n\t\t\t};\n\t\t\tfilters.unattached = {\n\t\t\t\ttext:  wp.media.view.l10n.unattached,\n\t\t\t\tprops: {\n\t\t\t\t\tstatus    : null,\n\t\t\t\t\ttype      : null,\n\t\t\t\t\tuploadedTo: 0,\n\t\t\t\t\torderby   : 'menuOrder',\n\t\t\t\t\torder     : 'ASC'\n\t\t\t\t},\n\t\t\t\tpriority: 50\n\t\t\t};\n\t\t\tthis.filters = filters;\n\t\t}\n\t});\n\n\tconst AttachmentsBrowserOrig = wp.media.view.AttachmentsBrowser;\n\tconst AttachmentsBrowserCustom = AttachmentsBrowserOrig.extend({\n\t\tcreateToolbar: function() {\n\t\t\tAttachmentsBrowserOrig.prototype.createToolbar.call( this );\n\t\t\tthis.toolbar.set(\n\t\t\t\t'mediaLibraryUploadedFilter',\n\t\t\t\tnew MediaLibraryUploadedFilter({\n\t\t\t\t\tcontroller: this.controller,\n\t\t\t\t\tmodel:      this.collection.props,\n\t\t\t\t\tpriority:   -100\n\t\t\t\t}).render()\n\t\t\t);\n\t\t}\n\t});\n}\n"]}