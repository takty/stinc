{"version":3,"sources":["assets/lib/picker-link.js"],"names":["window","wpinc","dia","setLinkPicker","setValueToCls","p","cls","v","e","Array","from","getElementsByClassName","HTMLInputElement","value","tagName","setAttribute","innerText","postTypeSpec","lastPostTypeSpec","isPostTypeSpecInitialized","elm","fn","opts","Object","assign","isInternalOnly","isLinkTargetAllowed","parentGen","postType","addEventListener","getAttribute","preventDefault","callbackFunc","id","Math","random","ta","document","createElement","style","display","body","appendChild","scan","wpLink","modalOpen","f","d","innerHTML","a","getElementsByTagName","url","href","title","readAnchorLink","jQuery","find","off","onSelect","removeChild","close","li","val","hasClass","children","text","init","lastSearch","empty","ajaxSetup","beforeSend","jqXHR","data","each","split","i","kv","setPostTypeSpecification","open","func","time","toFunc","setTimeout","executeTimeoutFunc","on","show","qrs","querySelectorAll","length","maxHeight","hide","optionHeight","height","createLink","gen","parentNode","getParent","target","setItem"],"mappings":"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","file":"assets\\lib\\picker-link.min.js","sourcesContent":["/**\n * Link Picker\n *\n * @author Takuto Yanagida\n * @version 2023-03-06\n */\n\nwindow.wpinc     = window.wpinc ?? {}\nwindow.wpinc.dia = window.wpinc.dia ?? {}\n\nwindow.wpinc.dia.setLinkPicker = (function () {\n\n\tfunction setLinkPicker(elm, cls = false, fn = null, opts = {}) {\n\t\tif (cls === false) cls = 'link';\n\t\topts = Object.assign({ isInternalOnly: false, isLinkTargetAllowed: false, parentGen: -1, postType: null }, opts);\n\n\t\telm.addEventListener('click', e => {\n\t\t\tif (elm.getAttribute('disabled')) return;\n\t\t\te.preventDefault();\n\t\t\tcreateLink(f => {\n\t\t\t\tconst p = (opts.parentGen !== -1) ? getParent(e.target, opts.parentGen) : null;\n\t\t\t\tif (p) setItem(p, cls, f);\n\t\t\t\tif (fn) fn(e.target, f);\n\t\t\t}, opts.isInternalOnly, opts.isLinkTargetAllowed, opts.postType);\n\t\t});\n\t}\n\n\tfunction getParent(e, gen) {\n\t\twhile (0 < gen-- && e.parentNode) e = e.parentNode;\n\t\treturn e;\n\t}\n\n\tfunction setItem(p, cls, f) {\n\t\tsetValueToCls(p, `${cls}-url`, f.url);\n\t\tsetValueToCls(p, `${cls}-title`, f.title);\n\t\tsetValueToCls(p, `${cls}-post-id`, '');\n\t}\n\n\tfunction setValueToCls(p, cls, v) {\n\t\tfor (const e of Array.from(p.getElementsByClassName(cls))) {\n\t\t\tif (e instanceof HTMLInputElement) {\n\t\t\t\te.value = v;\n\t\t\t} else if (e.tagName === 'A') {\n\t\t\t\te.setAttribute('href', v);\n\t\t\t} else {\n\t\t\t\te.innerText = v;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction createLink(callbackFunc, isInternalOnly, isLinkTargetAllowed, postType) {\n\t\tconst id = 'picker-link-ta' + (0 | (Math.random() * 8191));\n\t\tconst ta = document.createElement('textarea');\n\t\tta.style.display = 'none';\n\t\tta.id = id;\n\t\tdocument.body.appendChild(ta);\n\n\t\tconst scan = function () {\n\t\t\tif (wpLink.modalOpen && ta.value === '') return false;\n\n\t\t\tif (ta.value !== '') {\n\t\t\t\tconst f = readAnchorLink(ta);\n\t\t\t\tjQuery('#wp-link').find('.query-results').off('river-select', onSelect);\n\t\t\t\tdocument.body.removeChild(ta);\n\t\t\t\tcallbackFunc(f);\n\t\t\t}\n\t\t\tpostTypeSpec = null;\n\t\t\twpLink.close();\n\t\t\treturn true;\n\t\t}\n\t\tconst onSelect = function (e, li) {\n\t\t\tconst val = (li.hasClass('no-title')) ? '' : li.children('.item-title').text();\n\t\t\tjQuery('#wp-link-text').val(val);\n\t\t};\n\t\tsetPostTypeSpecification(postType);\n\n\t\twpLink.open(id);\n\t\texecuteTimeoutFunc(scan, 100);\n\t\tjQuery('#wp-link').find('.query-results').on('river-select', onSelect);\n\n\t\tjQuery('#link-options').show();\n\t\tjQuery('#wplink-enter-url').show();\n\t\tjQuery('#wplink-enter-url + div').show();\n\t\tjQuery('#wplink-link-existing-content').show();\n\t\tjQuery('#link-options > .link-target').show();\n\n\t\tconst qrs = document.querySelectorAll('#wp-link .query-results');\n\t\tfor (let i = 0; i < qrs.length; i += 1) {\n\t\t\tqrs[i].style.maxHeight = 'unset';\n\t\t}\n\t\tjQuery('.wp-link-text-field').hide();\n\t\tlet optionHeight = 208;\n\t\tif (isInternalOnly) {\n\t\t\tjQuery('#wplink-enter-url').hide();\n\t\t\tjQuery('#wplink-enter-url + div').hide();\n\t\t\tjQuery('#wplink-link-existing-content').hide();\n\t\t\toptionHeight -= 96;\n\t\t}\n\t\tif (!isLinkTargetAllowed) {\n\t\t\tjQuery('#link-options > .link-target').hide();\n\t\t\toptionHeight -= 32;\n\t\t}\n\t\tif (isInternalOnly && !isLinkTargetAllowed) {\n\t\t\tjQuery('#link-options').hide();\n\t\t\toptionHeight -= 20;\n\t\t}\n\t\tfor (let i = 0; i < qrs.length; i += 1) {\n\t\t\tqrs[i].style.height = `calc(100% - ${optionHeight}px)`;\n\t\t}\n\t}\n\n\tfunction readAnchorLink(ta) {\n\t\tconst d = document.createElement('div');\n\t\td.innerHTML = ta.value;\n\t\tconst a = d.getElementsByTagName('a')[0];\n\t\treturn { url: a.href, title: a.innerText };\n\t}\n\n\tfunction executeTimeoutFunc(func, time) {\n\t\tconst toFunc = function () {\n\t\t\tif (!func()) setTimeout(toFunc, time);\n\t\t}\n\t\tsetTimeout(toFunc, time);\n\t}\n\n\tlet postTypeSpec              = null;\n\tlet lastPostTypeSpec          = null;\n\tlet isPostTypeSpecInitialized = false;\n\n\tfunction setPostTypeSpecification(postType) {\n\t\tpostTypeSpec = postType;\n\t\tif (postType === null || postType === lastPostTypeSpec) return;\n\t\tlastPostTypeSpec = postType;\n\n\t\twpLink.init();\n\t\twpLink.lastSearch = '';\n\t\tjQuery('#search-results > ul').empty();\n\t\tjQuery('#most-recent-results > ul').empty();\n\n\t\tif (isPostTypeSpecInitialized) return;\n\t\tisPostTypeSpecInitialized = true;\n\n\t\tjQuery.ajaxSetup({\n\t\t\tbeforeSend: function (jqXHR, d) {\n\t\t\t\tif (!d.data) return true;\n\t\t\t\tif (!postTypeSpec) return true;\n\t\t\t\tjQuery.each(d.data.split('&'), function (i, p) {\n\t\t\t\t\tconst kv = p.split('=');\n\t\t\t\t\tif (kv[0] === 'action' && kv[1] === 'wp-link-ajax') {\n\t\t\t\t\t\td.data += '&link_picker_pt=' + postTypeSpec;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\treturn setLinkPicker;\n})();\n"]}