{"version":3,"sources":["assets/lib/picker-link.js"],"names":["window","wpinc","dia","setLinkPicker","postTypeSpec","lastPostTypeSpec","isPostTypeSpecInitialized","elm","cls","fn","opts","Object","assign","isInternalOnly","isLinkTargetAllowed","parentGen","postType","addEventListener","e","getAttribute","preventDefault","callbackFunc","id","Math","random","ta","document","createElement","style","display","body","appendChild","scan","wpLink","modalOpen","value","f","d","innerHTML","a","getElementsByTagName","url","href","title","innerText","readAnchorLink","jQuery","find","off","onSelect","removeChild","close","li","val","hasClass","children","text","init","lastSearch","empty","ajaxSetup","beforeSend","jqXHR","data","each","split","i","p","kv","setPostTypeSpecification","open","func","time","toFunc","setTimeout","executeTimeoutFunc","on","show","qrs","querySelectorAll","length","top","hide","createLink","target"],"mappings":"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","file":"assets\\lib\\picker-link.min.js","sourcesContent":["/**\n * Link Picker\n *\n * @author Takuto Yanagida\n * @version 2022-02-03\n */\n\nwindow.wpinc     = window.wpinc ?? {}\nwindow.wpinc.dia = window.wpinc.dia ?? {}\n\nwindow.wpinc.dia.setLinkPicker = (function () {\n\n\tfunction setLinkPicker(elm, cls = false, fn = null, opts = {}) {\n\t\tif (cls === false) cls = 'link';\n\t\topts = Object.assign({ isInternalOnly: false, isLinkTargetAllowed: false, parentGen: 1, postType: null }, opts);\n\n\t\telm.addEventListener('click', e => {\n\t\t\tif (elm.getAttribute('disabled')) return;\n\t\t\te.preventDefault();\n\t\t\tcreateLink(f => {\n\t\t\t\tif (fn) fn(e.target, f);\n\t\t\t}, opts.isInternalOnly, opts.isLinkTargetAllowed, opts.postType);\n\t\t});\n\t}\n\n\tfunction createLink(callbackFunc, isInternalOnly, isLinkTargetAllowed, postType) {\n\t\tconst id = 'picker-link-ta' + (0 | (Math.random() * 8191));\n\t\tconst ta = document.createElement('textarea');\n\t\tta.style.display = 'none';\n\t\tta.id = id;\n\t\tdocument.body.appendChild(ta);\n\n\t\tconst scan = function () {\n\t\t\tif (wpLink.modalOpen && ta.value === '') return false;\n\n\t\t\tif (ta.value !== '') {\n\t\t\t\tconst f = readAnchorLink(ta);\n\t\t\t\tjQuery('#wp-link').find('.query-results').off('river-select', onSelect);\n\t\t\t\tdocument.body.removeChild(ta);\n\t\t\t\tcallbackFunc(f);\n\t\t\t}\n\t\t\tpostTypeSpec = null;\n\t\t\twpLink.close();\n\t\t\treturn true;\n\t\t}\n\t\tconst onSelect = function (e, li) {\n\t\t\tconst val = (li.hasClass('no-title')) ? '' : li.children('.item-title').text();\n\t\t\tjQuery('#wp-link-text').val(val);\n\t\t};\n\t\tsetPostTypeSpecification(postType);\n\n\t\twpLink.open(id);\n\t\texecuteTimeoutFunc(scan, 100);\n\t\tjQuery('#wp-link').find('.query-results').on('river-select', onSelect);\n\n\t\tjQuery('#link-options').show();\n\t\tjQuery('#wplink-link-existing-content').show();\n\t\tjQuery('#link-options > .link-target').show();\n\t\tconst qrs = document.querySelectorAll('#link-selector .query-results');\n\t\tfor (let i = 0; i < qrs.length; i += 1) qrs[i].style.top = '';\n\n\t\tif (isInternalOnly) {\n\t\t\tjQuery('#link-options').hide();\n\t\t\tjQuery('#wplink-link-existing-content').hide();\n\t\t\tfor (let i = 0; i < qrs.length; i += 1) qrs[i].style.top = '48px';\n\t\t} else if (!isLinkTargetAllowed) {\n\t\t\tjQuery('#link-options > .link-target').hide();\n\t\t\tfor (let i = 0; i < qrs.length; i += 1) qrs[i].style.top = '177px';\n\t\t}\n\t}\n\n\tfunction readAnchorLink(ta) {\n\t\tconst d = document.createElement('div');\n\t\td.innerHTML = ta.value;\n\t\tconst a = d.getElementsByTagName('a')[0];\n\t\treturn { url: a.href, title: a.innerText };\n\t}\n\n\tfunction executeTimeoutFunc(func, time) {\n\t\tconst toFunc = function () {\n\t\t\tif (!func()) setTimeout(toFunc, time);\n\t\t}\n\t\tsetTimeout(toFunc, time);\n\t}\n\n\tlet postTypeSpec              = null;\n\tlet lastPostTypeSpec          = null;\n\tlet isPostTypeSpecInitialized = false;\n\n\tfunction setPostTypeSpecification(postType) {\n\t\tpostTypeSpec = postType;\n\t\tif (postType === null || postType === lastPostTypeSpec) return;\n\t\tlastPostTypeSpec = postType;\n\n\t\twpLink.init();\n\t\twpLink.lastSearch = '';\n\t\tjQuery('#search-results > ul').empty();\n\t\tjQuery('#most-recent-results > ul').empty();\n\n\t\tif (isPostTypeSpecInitialized) return;\n\t\tisPostTypeSpecInitialized = true;\n\n\t\tjQuery.ajaxSetup({\n\t\t\tbeforeSend: function (jqXHR, d) {\n\t\t\t\tif (!d.data) return true;\n\t\t\t\tif (!postTypeSpec) return true;\n\t\t\t\tjQuery.each(d.data.split('&'), function (i, p) {\n\t\t\t\t\tconst kv = p.split('=');\n\t\t\t\t\tif (kv[0] === 'action' && kv[1] === 'wp-link-ajax') {\n\t\t\t\t\t\td.data += '&link_picker_pt=' + postTypeSpec;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\treturn setLinkPicker;\n})();\n"]}