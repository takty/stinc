{"version":3,"sources":["assets/js/link-picker.js"],"names":["wpinc_link_picker_init","key","internal_only","max_count","do_allow_url_hash","post_type","body","document","querySelector","add_row","getElementsByClassName","add_btn","tbl","items","temp","picker_opts","isInternalOnly","isLinkTargetAllowed","postType","jQuery","sortable","axis","containment","cursor","handle","placeholder","update","reorder_item_names","it","assign_event_listener","i","length","inputs","querySelectorAll","input","sub","dataset","name","set_item","l","value","url","title","readOnly","del_btn","sel_btn","opener","addEventListener","e","target","checked","classList","add","remove","window","open","wpinc","dia","setLinkPicker","t","Object","assign","innerText","setAttribute","cloneNode","insertBefore","add_new_item"],"mappings":"AAOA,SAASA,uBAAuBC,EAAKC,GAAgB,EAAOC,EAAY,KAAMC,GAAoB,EAAOC,EAAY,MACpH,MAAMC,EAAUC,SAASC,cAAe,0BAAyBP,KAC3DQ,EAAUH,EAAKI,uBAAuB,WAAW,GACjDC,EAAUF,EAAQD,cAAc,eAEhCI,EAAQN,EAAKI,uBAAuB,SAAS,GAC7CG,EAAQD,EAAIF,uBAAuB,QACnCI,EAAQF,EAAIJ,cAAc,kBAE1BO,EAAc,CACnBC,eAAqBd,EACrBe,oBAAqBb,EACrBc,SAAqBb,GAGtBc,OAAOP,GAAKQ,WACZD,OAAOP,GAAKQ,SAAS,SAAU,CAC9BC,KAAa,IACbC,YAAa,SACbC,OAAa,OACbC,OAAa,UACbX,MAAa,UACbY,YAAa,mBACbC,OAAaC,IAGdA,IACA,IAAK,MAAMC,KAAMf,EAAOgB,EAAsBD,GAa9C,SAASD,IACR,IAAK,IAAIG,EAAI,EAAGA,EAAIjB,EAAMkB,OAAQD,GAAK,EAAG,CACzC,MAAME,EAASnB,EAAMiB,GAAGG,iBAAiB,eACzC,IAAK,MAAMC,KAASF,EAAQ,CAC3B,MAAMG,EAAOD,EAAME,QAAQnC,IAC3BiC,EAAMG,KAAQ,GAAEpC,KAAO6B,MAAMK,IAC9B,CACD,CACD,CAWA,SAASG,EAASV,EAAIW,GACrBX,EAAGpB,cAAc,qBAAqBgC,MAAYD,EAAEE,IACpDb,EAAGpB,cAAc,uBAAuBgC,MAAUD,EAAEG,MACpDd,EAAGpB,cAAc,yBAAyBgC,MAAQ,GAC9CtC,IACH0B,EAAGpB,cAAc,qBAAqBmC,UAAW,EAEnD,CAEA,SAASd,EAAsBD,GAC9B,MAAMgB,EAAUhB,EAAGlB,uBAAuB,UAAU,GAC9CmC,EAAUjB,EAAGlB,uBAAuB,UAAU,GAC9CoC,EAAUlB,EAAGlB,uBAAuB,UAAU,GAEpDkC,EAAQG,iBAAiB,SAAUC,IAC9BA,EAAEC,OAAOC,QACZtB,EAAGuB,UAAUC,IAAI,cAEjBxB,EAAGuB,UAAUE,OAAO,aACrB,IAEDP,EAAOC,iBAAiB,SAAS,KAChC,MAAMN,EAAMb,EAAGpB,cAAc,qBAAqBgC,MAC9CC,GAAKa,OAAOC,KAAKd,EAAI,IAE1Ba,OAAOE,MAAMC,IAAIC,cAAcb,GAAS,GAAO,CAACc,EAAGpB,IAAMD,EAASV,EAAIW,IAAIqB,OAAOC,OAAO9C,EAAa,CAAE2B,MAAOG,EAAQiB,YACvH,CAzDI3D,GAAaA,GAAaU,EAAMkB,QAAQpB,EAAQoD,aAAa,WAAY,QAE7ET,OAAOE,MAAMC,IAAIC,cAAc/C,GAAS,GAAO,CAACgD,EAAGpB,MAoBnD,SAAsBA,GACrB,MAAMX,EAAKd,EAAKkD,WAAU,GAC1B1B,EAASV,EAAIW,GACbX,EAAGuB,UAAUE,OAAO,iBACpBzB,EAAGuB,UAAUC,IAAI,QACjBxC,EAAIqD,aAAarC,EAAInB,GACrBoB,EAAsBD,EACvB,CA1BCsC,CAAa3B,GACbZ,IACIxB,GAAaA,GAAaU,EAAMkB,QAAQpB,EAAQoD,aAAa,WAAY,OAAO,GAClFH,OAAOC,OAAO9C,EAAa,CAAE2B,MAAO/B,EAAQmD,YAoDhD","file":"assets\\js\\link-picker.min.js","sourcesContent":["/**\n * Link Picker\n *\n * @author Takuto Yanagida\n * @version 2022-06-16\n */\n\nfunction wpinc_link_picker_init(key, internal_only = false, max_count = null, do_allow_url_hash = false, post_type = null) {\n\tconst body    = document.querySelector(`.wpinc-dia-link-picker#${key}`);\n\tconst add_row = body.getElementsByClassName('add-row')[0];\n\tconst add_btn = add_row.querySelector('.button.add');\n\n\tconst tbl   = body.getElementsByClassName('table')[0];\n\tconst items = tbl.getElementsByClassName('item');\n\tconst temp  = tbl.querySelector('.item-template');\n\n\tconst picker_opts = {\n\t\tisInternalOnly     : internal_only,\n\t\tisLinkTargetAllowed: do_allow_url_hash,\n\t\tpostType           : post_type\n\t};\n\n\tjQuery(tbl).sortable();\n\tjQuery(tbl).sortable('option', {\n\t\taxis       : 'y',\n\t\tcontainment: 'parent',\n\t\tcursor     : 'move',\n\t\thandle     : '.handle',\n\t\titems      : '> .item',\n\t\tplaceholder: 'item-placeholder',\n\t\tupdate     : reorder_item_names,\n\t});\n\n\treorder_item_names();\n\tfor (const it of items) assign_event_listener(it);\n\tif (max_count && max_count <= items.length) add_btn.setAttribute('disabled', 'true');\n\n\twindow.wpinc.dia.setLinkPicker(add_btn, false, (t, l) => {\n\t\tadd_new_item(l);\n\t\treorder_item_names();\n\t\tif (max_count && max_count <= items.length) add_btn.setAttribute('disabled', 'true');\n\t}, Object.assign(picker_opts, { title: add_btn.innerText }));\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction reorder_item_names() {\n\t\tfor (let i = 0; i < items.length; i += 1) {\n\t\t\tconst inputs = items[i].querySelectorAll('*[data-key]');\n\t\t\tfor (const input of inputs) {\n\t\t\t\tconst sub  = input.dataset.key;\n\t\t\t\tinput.name = `${key}[${i}][${sub}]`;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction add_new_item(l) {\n\t\tconst it = temp.cloneNode(true);\n\t\tset_item(it, l);\n\t\tit.classList.remove('item-template');\n\t\tit.classList.add('item');\n\t\ttbl.insertBefore(it, add_row);\n\t\tassign_event_listener(it);\n\t}\n\n\tfunction set_item(it, l) {\n\t\tit.querySelector('*[data-key=\"url\"]').value     = l.url;\n\t\tit.querySelector('*[data-key=\"title\"]').value   = l.title;\n\t\tit.querySelector('*[data-key=\"post_id\"]').value = '';\n\t\tif (internal_only) {\n\t\t\tit.querySelector('*[data-key=\"url\"]').readOnly = true;\n\t\t}\n\t}\n\n\tfunction assign_event_listener(it) {\n\t\tconst del_btn = it.getElementsByClassName('delete')[0];\n\t\tconst sel_btn = it.getElementsByClassName('select')[0];\n\t\tconst opener  = it.getElementsByClassName('opener')[0];\n\n\t\tdel_btn.addEventListener('click', (e) => {\n\t\t\tif (e.target.checked) {\n\t\t\t\tit.classList.add('is-deleted');\n\t\t\t} else {\n\t\t\t\tit.classList.remove('is-deleted');\n\t\t\t}\n\t\t});\n\t\topener.addEventListener('click', () => {\n\t\t\tconst url = it.querySelector('*[data-key=\"url\"]').value;\n\t\t\tif (url) window.open(url);\n\t\t});\n\t\twindow.wpinc.dia.setLinkPicker(sel_btn, false, (t, l) => set_item(it, l), Object.assign(picker_opts, { title: sel_btn.innerText }));\n\t}\n}\n"]}