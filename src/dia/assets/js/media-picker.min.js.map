{"version":3,"sources":["assets/js/media-picker.js"],"names":["wpinc_media_picker_init","key","body","document","querySelector","add_row","getElementsByClassName","add_btn","tbl","items","temp","jQuery","sortable","axis","containment","cursor","handle","placeholder","update","reorder_item_names","it","assign_event_listener","i","length","inputs","querySelectorAll","input","sub","dataset","name","add_new_item","f","cloneNode","set_item","classList","remove","add","insertBefore","value","id","url","title","filename","innerText","del_btn","sel_btn","opener","addEventListener","e","target","checked","window","open","wpinc","dia","setMediaPicker","t","multiple","fs"],"mappings":"AAOA,SAASA,wBAAwBC,GAChC,MAAMC,EAAUC,SAASC,cAAe,2BAA0BH,KAC5DI,EAAUH,EAAKI,uBAAuB,WAAW,GACjDC,EAAUF,EAAQD,cAAc,eAEhCI,EAAQN,EAAKI,uBAAuB,SAAS,GAC7CG,EAAQD,EAAIF,uBAAuB,QACnCI,EAAQF,EAAIJ,cAAc,kBAEhCO,OAAOH,GAAKI,WACZD,OAAOH,GAAKI,SAAS,SAAU,CAC9BC,KAAa,IACbC,YAAa,SACbC,OAAa,OACbC,OAAa,UACbP,MAAa,UACbQ,YAAa,mBACbC,OAAaC,IAGdA,IACA,IAAK,MAAMC,KAAMX,EAAOY,EAAsBD,GAU9C,SAASD,IACR,IAAK,IAAIG,EAAI,EAAGA,EAAIb,EAAMc,OAAQD,GAAK,EAAG,CACzC,MAAME,EAASf,EAAMa,GAAGG,iBAAiB,eACzC,IAAK,MAAMC,KAASF,EAAQ,CAC3B,MAAMG,EAAOD,EAAME,QAAQ3B,IAC3ByB,EAAMG,KAAQ,GAAE5B,KAAOqB,MAAMK,IAC9B,CACD,CACD,CAEA,SAASG,EAAaC,GACrB,MAAMX,EAAKV,EAAKsB,WAAU,GAC1BC,EAASb,EAAIW,GACbX,EAAGc,UAAUC,OAAO,iBACpBf,EAAGc,UAAUE,IAAI,QACjB5B,EAAI6B,aAAajB,EAAIf,GACrBgB,EAAsBD,EACvB,CAEA,SAASa,EAASb,EAAIW,GACrBX,EAAGhB,cAAe,uBAAsBkC,MAAaP,EAAEQ,GACvDnB,EAAGhB,cAAe,qBAAoBkC,MAAeP,EAAES,IACvDpB,EAAGhB,cAAe,uBAAsBkC,MAAaP,EAAEU,MACvDrB,EAAGhB,cAAe,0BAAyBkC,MAAUP,EAAEW,SACvDtB,EAAGd,uBAAuB,YAAY,GAAGqC,UAAYZ,EAAEW,QACxD,CAEA,SAASrB,EAAsBD,GAC9B,MAAMwB,EAAUxB,EAAGd,uBAAuB,UAAU,GAC9CuC,EAAUzB,EAAGd,uBAAuB,UAAU,GAC9CwC,EAAU1B,EAAGd,uBAAuB,UAAU,GAEpDsC,EAAQG,iBAAiB,SAAUC,IAC9BA,EAAEC,OAAOC,QACZ9B,EAAGc,UAAUE,IAAI,cAEjBhB,EAAGc,UAAUC,OAAO,aACrB,IAEDW,EAAOC,iBAAiB,SAAS,KAChC,MAAMP,EAAMpB,EAAGhB,cAAe,qBAAoBkC,MAC9CE,GAAKW,OAAOC,KAAKZ,EAAI,IAE1BW,OAAOE,MAAMC,IAAIC,eAAeV,GAAS,GAAO,CAACW,EAAGzB,IAAME,EAASb,EAAIW,IAAI,CAAE0B,UAAU,EAAOhB,MAAOI,EAAQF,WAC9G,CArDAQ,OAAOE,MAAMC,IAAIC,eAAehD,GAAS,GAAO,CAACiD,EAAGE,KACnD,IAAK,MAAM3B,KAAK2B,EAAI5B,EAAaC,GACjCZ,GAAoB,GAClB,CAAEsC,UAAU,EAAMhB,MAAOlC,EAAQoC,WAmDrC","file":"assets\\js\\media-picker.min.js","sourcesContent":["/**\n * Media Picker\n *\n * @author Takuto Yanagida\n * @version 2022-02-03\n */\n\nfunction wpinc_media_picker_init(key) {\n\tconst body    = document.querySelector(`.wpinc-dia-media-picker#${key}`);\n\tconst add_row = body.getElementsByClassName('add-row')[0];\n\tconst add_btn = add_row.querySelector('.button.add');\n\n\tconst tbl   = body.getElementsByClassName('table')[0];\n\tconst items = tbl.getElementsByClassName('item');\n\tconst temp  = tbl.querySelector('.item-template');\n\n\tjQuery(tbl).sortable();\n\tjQuery(tbl).sortable('option', {\n\t\taxis       : 'y',\n\t\tcontainment: 'parent',\n\t\tcursor     : 'move',\n\t\thandle     : '.handle',\n\t\titems      : '> .item',\n\t\tplaceholder: 'item-placeholder',\n\t\tupdate     : reorder_item_names,\n\t});\n\n\treorder_item_names();\n\tfor (const it of items) assign_event_listener(it);\n\twindow.wpinc.dia.setMediaPicker(add_btn, false, (t, fs) => {\n\t\tfor (const f of fs) add_new_item(f);\n\t\treorder_item_names();\n\t}, { multiple: true, title: add_btn.innerText });\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction reorder_item_names() {\n\t\tfor (let i = 0; i < items.length; i += 1) {\n\t\t\tconst inputs = items[i].querySelectorAll('*[data-key]');\n\t\t\tfor (const input of inputs) {\n\t\t\t\tconst sub  = input.dataset.key;\n\t\t\t\tinput.name = `${key}[${i}][${sub}]`;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction add_new_item(f) {\n\t\tconst it = temp.cloneNode(true);\n\t\tset_item(it, f);\n\t\tit.classList.remove('item-template');\n\t\tit.classList.add('item');\n\t\ttbl.insertBefore(it, add_row);\n\t\tassign_event_listener(it);\n\t}\n\n\tfunction set_item(it, f) {\n\t\tit.querySelector(`*[data-key='media']`).value      = f.id;\n\t\tit.querySelector(`*[data-key='url']`).value        = f.url;\n\t\tit.querySelector(`*[data-key='title']`).value      = f.title;\n\t\tit.querySelector(`*[data-key='filename']`).value   = f.filename;\n\t\tit.getElementsByClassName('filename')[0].innerText = f.filename;\n\t}\n\n\tfunction assign_event_listener(it) {\n\t\tconst del_btn = it.getElementsByClassName('delete')[0];\n\t\tconst sel_btn = it.getElementsByClassName('select')[0];\n\t\tconst opener  = it.getElementsByClassName('opener')[0];\n\n\t\tdel_btn.addEventListener('click', (e) => {\n\t\t\tif (e.target.checked) {\n\t\t\t\tit.classList.add('is-deleted');\n\t\t\t} else {\n\t\t\t\tit.classList.remove('is-deleted');\n\t\t\t}\n\t\t});\n\t\topener.addEventListener('click', () => {\n\t\t\tconst url = it.querySelector(`*[data-key='url']`).value;\n\t\t\tif (url) window.open(url);\n\t\t});\n\t\twindow.wpinc.dia.setMediaPicker(sel_btn, false, (t, f) => set_item(it, f), { multiple: false, title: sel_btn.innerText });\n\t}\n}\n"]}