{"version":3,"sources":["assets/lib/picker-link.js"],"names":["document","addEventListener","elms","querySelectorAll","i","length","setLinkPicker","setValueToCls","parent","cls","value","getElementsByClassName","HTMLInputElement","tagName","setAttribute","innerText","postTypeSpec","lastPostTypeSpec","isPostTypeSpecInitialized","elm","fn","opts","Object","assign","isInternalOnly","isLinkTargetAllowed","parentGen","postType","e","getAttribute","preventDefault","callbackFunc","id","Math","random","ta","createElement","style","display","body","appendChild","scan","wpLink","modalOpen","f","d","innerHTML","a","getElementsByTagName","url","href","title","readAnchorLink","jQuery","find","off","onSelect","removeChild","close","li","val","hasClass","children","text","init","lastSearch","empty","ajaxSetup","beforeSend","jqXHR","data","each","split","p","kv","setPostTypeSpecification","open","func","time","toFunc","setTimeout","executeTimeoutFunc","on","show","qrs","top","hide","createLink","gen","parentNode","getParent","target","setItem"],"mappings":"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","file":"assets\\lib\\picker-link.min.js","sourcesContent":["/**\n *\n * Link Picker (JS)\n *\n * @author Takuto Yanagida @ Space-Time Inc.\n * @version 2020-11-19\n *\n */\n\n\ndocument.addEventListener('DOMContentLoaded', function () {\n\tconst elms = document.querySelectorAll('*[data-picker=\"link\"]');\n\tfor (let i = 0; i < elms.length; i += 1) {\n\t\tsetLinkPicker(elms[i]);\n\t}\n});\n\nconst setLinkPicker = (function () {\n\n\tfunction setLinkPicker(elm, cls = false, fn = null, opts = {}) {\n\t\tif (cls === false) cls = 'link';\n\t\topts = Object.assign({ isInternalOnly: false, isLinkTargetAllowed: false, parentGen: 1, postType: null }, opts);\n\n\t\telm.addEventListener('click', function (e) {\n\t\t\tif (elm.getAttribute('disabled')) return;\n\t\t\te.preventDefault();\n\t\t\tcreateLink(function (f) {\n\t\t\t\tconst parent = getParent(e.target, opts.parentGen);\n\t\t\t\tsetItem(parent, cls, f);\n\t\t\t\tif (fn) fn(e.target, f);\n\t\t\t}, opts.isInternalOnly, opts.isLinkTargetAllowed, opts.postType);\n\t\t});\n\t}\n\n\tfunction getParent(elm, gen) {\n\t\twhile (0 < gen-- && elm.parentNode) elm = elm.parentNode;\n\t\treturn elm;\n\t}\n\n\tfunction setItem(parent, cls, f) {\n\t\tsetValueToCls(parent, cls + '-url', f.url);\n\t\tsetValueToCls(parent, cls + '-title', f.title);\n\t\tsetValueToCls(parent, cls + '-post-id', '');\n\t}\n\n\tfunction setValueToCls(parent, cls, value) {\n\t\tconst elms = parent.getElementsByClassName(cls);\n\t\tfor (let i = 0; i < elms.length; i += 1) {\n\t\t\tif (elms[i] instanceof HTMLInputElement) {\n\t\t\t\telms[i].value = value;\n\t\t\t} else if (elms[i].tagName === 'A') {\n\t\t\t\telms[i].setAttribute('href', value);\n\t\t\t} else {\n\t\t\t\telms[i].innerText = value;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction createLink(callbackFunc, isInternalOnly, isLinkTargetAllowed, postType) {\n\t\tconst id = 'picker-link-ta' + (0 | (Math.random() * 8191));\n\t\tconst ta = document.createElement('textarea');\n\t\tta.style.display = 'none';\n\t\tta.id = id;\n\t\tdocument.body.appendChild(ta);\n\n\t\tconst scan = function () {\n\t\t\tif (wpLink.modalOpen && ta.value === '') return false;\n\n\t\t\tif (ta.value !== '') {\n\t\t\t\tconst f = readAnchorLink(ta);\n\t\t\t\tjQuery('#wp-link').find('.query-results').off('river-select', onSelect);\n\t\t\t\tdocument.body.removeChild(ta);\n\t\t\t\tcallbackFunc(f);\n\t\t\t}\n\t\t\tpostTypeSpec = null;\n\t\t\twpLink.close();\n\t\t\treturn true;\n\t\t}\n\t\tconst onSelect = function (e, li) {\n\t\t\tconst val = (li.hasClass('no-title')) ? '' : li.children('.item-title').text();\n\t\t\tjQuery('#wp-link-text').val(val);\n\t\t};\n\t\tsetPostTypeSpecification(postType);\n\n\t\twpLink.open(id);\n\t\texecuteTimeoutFunc(scan, 100);\n\t\tjQuery('#wp-link').find('.query-results').on('river-select', onSelect);\n\n\t\tjQuery('#link-options').show();\n\t\tjQuery('#wplink-link-existing-content').show();\n\t\tjQuery('#link-options > .link-target').show();\n\t\tconst qrs = document.querySelectorAll('#link-selector .query-results');\n\t\tfor (let i = 0; i < qrs.length; i += 1) qrs[i].style.top = '';\n\n\t\tif (isInternalOnly) {\n\t\t\tjQuery('#link-options').hide();\n\t\t\tjQuery('#wplink-link-existing-content').hide();\n\t\t\tfor (let i = 0; i < qrs.length; i += 1) qrs[i].style.top = '48px';\n\t\t} else if (!isLinkTargetAllowed) {\n\t\t\tjQuery('#link-options > .link-target').hide();\n\t\t\tfor (let i = 0; i < qrs.length; i += 1) qrs[i].style.top = '177px';\n\t\t}\n\t}\n\n\tfunction readAnchorLink(ta) {\n\t\tconst d = document.createElement('div');\n\t\td.innerHTML = ta.value;\n\t\tconst a = d.getElementsByTagName('a')[0];\n\t\treturn { url: a.href, title: a.innerText };\n\t}\n\n\tfunction executeTimeoutFunc(func, time) {\n\t\tconst toFunc = function () {\n\t\t\tif (!func()) setTimeout(toFunc, time);\n\t\t}\n\t\tsetTimeout(toFunc, time);\n\t}\n\n\tlet postTypeSpec = null;\n\tlet lastPostTypeSpec = null;\n\tlet isPostTypeSpecInitialized = false;\n\n\tfunction setPostTypeSpecification(postType) {\n\t\tpostTypeSpec = postType;\n\t\tif (postType === null || postType === lastPostTypeSpec) return;\n\t\tlastPostTypeSpec = postType;\n\n\t\twpLink.init();\n\t\twpLink.lastSearch = '';\n\t\tjQuery('#search-results > ul').empty();\n\t\tjQuery('#most-recent-results > ul').empty();\n\n\t\tif (isPostTypeSpecInitialized) return;\n\t\tisPostTypeSpecInitialized = true;\n\n\t\tjQuery.ajaxSetup({\n\t\t\tbeforeSend: function (jqXHR, d) {\n\t\t\t\tif (!d.data) return true;\n\t\t\t\tif (!postTypeSpec) return true;\n\t\t\t\tjQuery.each(d.data.split('&'), function (i, p) {\n\t\t\t\t\tconst kv = p.split('=');\n\t\t\t\t\tif (kv[0] === 'action' && kv[1] === 'wp-link-ajax') {\n\t\t\t\t\t\td.data += '&link_picker_pt=' + postTypeSpec;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\treturn setLinkPicker;\n})();\n"]}