{"version":3,"sources":["assets/lib/picker-media.js"],"names":["setMediaPicker","elm","cls","fn","opts","Object","assign","multiple","type","parentGen","title","postId","document","getElementById","value","cm","setItem","parent","f","setValueToCls","id","url","filename","elms","getElementsByClassName","i","length","HTMLInputElement","innerText","addEventListener","e","preventDefault","wp","media","view","AttachmentsBrowser","AttachmentsBrowserCustom","model","settings","post","library","frame","uploader","options","params","post_id","createMedia","target","on","gen","parentNode","getParent","fileJsons","state","get","map","toJSON","fileJson","first","sel","mid","at","attachment","fetch","add","AttachmentsBrowserOrig","open","MediaLibraryUploadedFilter","AttachmentFilters","extend","createFilters","filters","all","text","l10n","allMediaItems","props","status","uploadedTo","orderby","order","priority","uploaded","uploadedToThisPost","unattached","this","createToolbar","prototype","call","toolbar","set","controller","collection","render","querySelectorAll"],"mappings":"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","file":"assets\\lib\\picker-media.min.js","sourcesContent":["/**\n *\n * Media Picker (JS)\n *\n * @author Takuto Yanagida\n * @version 2022-01-17\n *\n */\n\n\ndocument.addEventListener('DOMContentLoaded', function () {\n\tconst elms = document.querySelectorAll('*[data-picker=\"media\"]');\n\tfor (let i = 0; i < elms.length; i += 1) {\n\t\tsetMediaPicker(elms[i]);\n\t}\n});\n\nfunction setMediaPicker(elm, cls = null, fn = null, opts = {}) {\n\tif (cls === null) cls = 'media';\n\topts = Object.assign({ multiple: false, type: '', parentGen: 1, title: null }, opts);\n\n\tconst postId = document.getElementById('post_ID').value;\n\tlet cm = null;\n\telm.addEventListener('click', function (e) {\n\t\te.preventDefault();\n\t\tif (!cm) {\n\t\t\twp.media.view.AttachmentsBrowser = AttachmentsBrowserCustom;\n\t\t\tcm = createMedia(postId, opts.title === null ? e.target.innerText : opts.title, opts.multiple, opts.type);\n\t\t\tcm.on('select', function () {\n\t\t\t\tconst parent = getParent(e.target, opts.parentGen);\n\t\t\t\tif (opts.multiple) {\n\t\t\t\t\tconst fs = cm.state().get('selection');\n\t\t\t\t\tconst fileJsons = fs.map((f) => f.toJSON());\n\t\t\t\t\tsetItem(parent, cls, fileJsons[0]);\n\t\t\t\t\tif (fn) fn(e.target, fileJsons);\n\t\t\t\t} else {\n\t\t\t\t\tconst f = cm.state().get('selection').first();\n\t\t\t\t\tconst fileJson = f.toJSON();\n\t\t\t\t\tsetItem(parent, cls, fileJson);\n\t\t\t\t\tif (fn) fn(e.target, fileJson);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (opts['media_id_input']) {\n\t\t\t\tcm.on('open', () => {\n\t\t\t\t\tconst sel = cm.state().get('selection');\n\t\t\t\t\tconst mid = document.getElementById(opts['media_id_input']).value;\n\t\t\t\t\tconst at = wp.media.attachment(mid);\n\t\t\t\t\tat.fetch();\n\t\t\t\t\tsel.add(at ? [at] : []);\n\t\t\t\t});\n\t\t\t}\n\t\t\tcm.on('close', function () {\n\t\t\t\twp.media.view.AttachmentsBrowser = AttachmentsBrowserOrig;\n\t\t\t});\n\t\t}\n\t\tcm.open();\n\t});\n\n\tfunction getParent(elm, gen) {\n\t\twhile (0 < gen-- && elm.parentNode) elm = elm.parentNode;\n\t\treturn elm;\n\t}\n\n\tfunction setItem(parent, cls, f) {\n\t\tsetValueToCls(parent, cls + '-id',       f.id);\n\t\tsetValueToCls(parent, cls + '-url',      f.url);\n\t\tsetValueToCls(parent, cls + '-title',    f.title);\n\t\tsetValueToCls(parent, cls + '-filename', f.filename);\n\t}\n\n\tfunction setValueToCls(parent, cls, value) {\n\t\tconst elms = parent.getElementsByClassName(cls);\n\t\tfor (let i = 0; i < elms.length; i += 1) {\n\t\t\tif (elms[i] instanceof HTMLInputElement) {\n\t\t\t\telms[i].value = value;\n\t\t\t} else {\n\t\t\t\telms[i].innerText = value;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction createMedia(postId, title, multiple, type) {\n\t\twp.media.model.settings.post.id = postId;\n\t\twp.media.view.settings.post.id  = postId;\n\n\t\tconst media = wp.media({\n\t\t\ttitle   : title,\n\t\t\tlibrary : {type: type},\n\t\t\tframe   : 'select',\n\t\t\tmultiple: multiple,\n\t\t});\n\t\t// For attaching uploaded file to post\n\t\tmedia.uploader.options.uploader.params.post_id = postId;\n\t\treturn media;\n\t}\n\n\t/*\n\t * Tha following enables our media picker selectable 'Uploaded to this post'.\n\t * https://cobbledco.de/adding-your-own-filter-to-the-media-uploader/\n\t */\n\tconst MediaLibraryUploadedFilter = wp.media.view.AttachmentFilters.extend({\n\t\tcreateFilters: function() {\n\t\t\tconst filters = {};\n\t\t\tfilters.all = {\n\t\t\t\ttext : wp.media.view.l10n.allMediaItems,\n\t\t\t\tprops: {\n\t\t\t\t\tstatus    : null,\n\t\t\t\t\ttype      : null,\n\t\t\t\t\tuploadedTo: null,\n\t\t\t\t\torderby   : 'date',\n\t\t\t\t\torder     : 'DESC'\n\t\t\t\t},\n\t\t\t\tpriority: 10\n\t\t\t};\n\t\t\tfilters.uploaded = {\n\t\t\t\ttext : wp.media.view.l10n.uploadedToThisPost,\n\t\t\t\tprops: {\n\t\t\t\t\tstatus    : null,\n\t\t\t\t\ttype      : null,\n\t\t\t\t\tuploadedTo: wp.media.view.settings.post.id,\n\t\t\t\t\torderby   : 'menuOrder',\n\t\t\t\t\torder     : 'ASC'\n\t\t\t\t},\n\t\t\t\tpriority: 20\n\t\t\t};\n\t\t\tfilters.unattached = {\n\t\t\t\ttext : wp.media.view.l10n.unattached,\n\t\t\t\tprops: {\n\t\t\t\t\tstatus    : null,\n\t\t\t\t\ttype      : null,\n\t\t\t\t\tuploadedTo: 0,\n\t\t\t\t\torderby   : 'menuOrder',\n\t\t\t\t\torder     : 'ASC'\n\t\t\t\t},\n\t\t\t\tpriority: 50\n\t\t\t};\n\t\t\tthis.filters = filters;\n\t\t}\n\t});\n\n\tconst AttachmentsBrowserOrig = wp.media.view.AttachmentsBrowser;\n\tconst AttachmentsBrowserCustom = AttachmentsBrowserOrig.extend({\n\t\tcreateToolbar: function() {\n\t\t\tAttachmentsBrowserOrig.prototype.createToolbar.call( this );\n\t\t\tthis.toolbar.set(\n\t\t\t\t'mediaLibraryUploadedFilter',\n\t\t\t\tnew MediaLibraryUploadedFilter({\n\t\t\t\t\tcontroller: this.controller,\n\t\t\t\t\tmodel     : this.collection.props,\n\t\t\t\t\tpriority  : -100\n\t\t\t\t}).render()\n\t\t\t);\n\t\t}\n\t});\n}\n"]}