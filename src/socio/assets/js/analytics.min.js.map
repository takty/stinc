{"version":3,"sources":["assets/js/analytics.js"],"names":["wpinc_socio_analytics_initialize","args","LS_KEY","tagId","do_show_dialog","expired","idDialog","idAccept","idReject","fn","gtag","window","dataLayer","push","arguments","analytics_storage","ad_storage","Date","initTag","dlg","document","getElementById","createElement","setAttribute","innerHTML","body","appendChild","createDialog","cfm","lsKey","limitDay","day","it","localStorage","getItem","jd","JSON","parse","r","utc","now","e","getState","setEnabled","removeAttribute","okBtn","noBtn","addEventListener","setState","domain","location","hostname","orig","cookie","cs","split","c","p","indexOf","n","substring","trim","startsWith","removeCookie","readyState","setTimeout","Object","keys","length","setItem","stringify","removeItem"],"mappings":"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","file":"assets/js/analytics.min.js","sourcesContent":["/**\n *\n * Analytics (JS)\n *\n * @author Takuto Yanagida\n * @version 2022-08-24\n *\n */\n\n\nfunction wpinc_socio_analytics_initialize(args) {\n\tconst LS_KEY = 'wpinc-socio-analytics';\n\tconst CFM_OK = 'ok';\n\tconst CFM_NO = 'no';\n\n\tconst tagId          = args['tag_id']         ?? '';\n\tconst do_show_dialog = args['do_show_dialog'] ?? false;\n\tconst expired        = args['expired_day']    ?? 7;\n\tconst idDialog       = args['id_dialog']      ?? 'wpinc-socio-analytics-dialog';\n\tconst idAccept       = args['id_accept']      ?? 'wpinc-socio-analytics-accept';\n\tconst idReject       = args['id_reject']      ?? 'wpinc-socio-analytics-reject';\n\n\tinitTag(tagId);\n\tif (!do_show_dialog) {\n\t\tsetEnabled();\n\t\treturn;\n\t}\n\n\tonLoad(() => {\n\t\tconst dlg = document.getElementById(idDialog) ?? createDialog(idDialog, idAccept, idReject);\n\t\tdlg.setAttribute('hidden', '');\n\n\t\tconst cfm = getState(LS_KEY, tagId, expired);\n\t\tif (null !== cfm) {\n\t\t\tif (CFM_OK === cfm) {\n\t\t\t\tsetEnabled();\n\t\t\t}\n\t\t} else {\n\t\t\tdlg.removeAttribute('hidden');\n\t\t\tconst okBtn = document.getElementById(idAccept);\n\t\t\tconst noBtn = document.getElementById(idReject);\n\n\t\t\tif (okBtn) {\n\t\t\t\tokBtn.addEventListener('click', () => {\n\t\t\t\t\tdlg.setAttribute('hidden', '');\n\t\t\t\t\tsetState(LS_KEY, tagId, CFM_OK);\n\t\t\t\t\tsetEnabled();\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (noBtn) {\n\t\t\t\tnoBtn.addEventListener('click', () => {\n\t\t\t\t\tdlg.setAttribute('hidden', '');\n\t\t\t\t\tsetState(LS_KEY, tagId, CFM_NO);\n\t\t\t\t\tremoveCookie();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction onLoad(fn) {\n\t\tif ('loading' === document.readyState) {\n\t\t\tdocument.addEventListener('DOMContentLoaded', fn);\n\t\t} else {\n\t\t\tsetTimeout(fn, 0);\n\t\t}\n\t}\n\n\tfunction createDialog(idDialog, idAccept, idReject) {\n\t\tconst dlg = document.createElement('div');\n\t\tdlg.setAttribute('id', idDialog);\n\t\tdlg.setAttribute('hidden', '');\n\t\tdlg.setAttribute('style', `position:fixed;inset:auto 1rem 1rem 1rem;z-index:99999;padding:1rem;background-color:#fff;box-shadow:0 0.25rem 0.5rem #0009;border-radius:0.5rem;`)\n\t\tdlg.innerHTML =\n\t\t\t`<div>\n\t\t\t\t<p>We use cookies to improve our website for users' usability and experience.</p>\n\t\t\t\t<p>To accept cookies, click 'Accept'.</p>\n\t\t\t</div>\n\t\t\t<div style=\"margin-top:1rem;text-align:right;\">\n\t\t\t\t<button id=\"${idAccept}\">Accept</button>&nbsp;\n\t\t\t\t<button id=\"${idReject}\">Reject</button>\n\t\t\t</div>`;\n\t\tdocument.body.appendChild(dlg);\n\t\treturn dlg;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction getState(lsKey, tagId, limitDay) {\n\t\tconst day = (1000 * 60 * 60 * 24);\n\t\tconst it  = localStorage.getItem(lsKey);\n\t\ttry {\n\t\t\tconst jd = JSON.parse(it);\n\t\t\tif (jd) {\n\t\t\t\tconst r   = jd[tagId] ?? {};\n\t\t\t\tconst cfm = r['cfm'] ?? null;\n\t\t\t\tconst utc = r['utc'] ?? null;\n\t\t\t\tif (cfm && utc && Date.now() - utc < limitDay * day) {\n\t\t\t\t\treturn cfm;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t}\n\t\treturn null;\n\t}\n\n\tfunction setState(lsKey, tagId, cfm) {\n\t\tconst it = localStorage.getItem(lsKey);\n\n\t\tlet jd = null;\n\t\ttry {\n\t\t\tjd = JSON.parse(it);\n\t\t} catch (e) {\n\t\t}\n\t\tif (!jd) jd = {};\n\n\t\tif (null === cfm) {\n\t\t\tdelete jd[tagId];\n\t\t\tif (Object.keys(jd).length) {\n\t\t\t\tlocalStorage.setItem(lsKey, JSON.stringify(jd));\n\t\t\t} else {\n\t\t\t\tlocalStorage.removeItem(lsKey);\n\t\t\t}\n\t\t} else {\n\t\t\tjd[tagId] = { cfm, utc: Date.now() };\n\t\t\tlocalStorage.setItem(lsKey, JSON.stringify(jd));\n\t\t}\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction initTag(tagId) {\n\t\twindow.dataLayer = window.dataLayer || [];\n\t\tfunction gtag() { window.dataLayer.push(arguments); }\n\t\tgtag('consent', 'default', { analytics_storage: 'denied' });\n\t\tgtag('consent', 'default', { ad_storage: 'denied' });\n\t\tgtag('set', 'ads_data_redaction', true);\n\t\tgtag('js', new Date());\n\t\tgtag('config', tagId);\n\t}\n\n\tfunction setEnabled() {\n\t\tfunction gtag() { window.dataLayer.push(arguments); }\n\t\tgtag('consent', 'update', { analytics_storage: 'granted' });\n\t}\n\n\tfunction removeCookie() {\n\t\tlet domain = location.hostname;\n\t\twhile (true) {\n\t\t\tconst orig = document.cookie;\n\t\t\tconst cs   = orig.split(';')\n\t\t\tfor (const c of cs) {\n\t\t\t\tconst p = c.indexOf('=')\n\t\t\t\tconst n = (-1 < p) ? c.substring(0, p).trim() : c.trim();\n\t\t\t\tif ('_ga' === n || '_gid' === n || n.startsWith('_ga_')) {\n\t\t\t\t\tdocument.cookie = `${n}=;max-age=0;domain=${domain}`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (orig !== document.cookie) break;\n\t\t\tconst p = domain.indexOf('.');\n\t\t\tif (-1 === p) break;\n\t\t\tdomain = domain.substring(p + 1);\n\t\t}\n\t}\n}\n"]}