{"version":3,"sources":["assets/js/analytics.js"],"names":["wpinc_socio_analytics_initialize","args","LS_KEY","tagId","limitDay","idDialog","idAccept","idReject","fn","setState","lsKey","cfm","it","localStorage","getItem","jd","JSON","parse","e","Object","keys","length","setItem","stringify","removeItem","utc","Date","now","setEnabled","window","dataLayer","push","arguments","gtag","analytics_storage","ad_storage","initTag","dlg","document","getElementById","createElement","setAttribute","innerHTML","body","appendChild","createDialog","day","r","getState","removeAttribute","okBtn","noBtn","addEventListener","domain","location","hostname","orig","cookie","cs","split","c","p","indexOf","n","substring","trim","startsWith","removeCookie","readyState","setTimeout"],"mappings":"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","file":"assets\\js\\analytics.min.js","sourcesContent":["/**\n *\n * Analytics (JS)\n *\n * @author Takuto Yanagida\n * @version 2022-08-24\n *\n */\n\n\nfunction wpinc_socio_analytics_initialize(args) {\n\tconst LS_KEY = 'wpinc-socio-analytics';\n\tconst CFM_OK = 'ok';\n\tconst CFM_NO = 'no';\n\n\tconst tagId    = args['tag_id']    ?? '';\n\tconst limitDay = args['limit_day'] ?? 7;\n\tconst idDialog = args['id_dialog'] ?? 'wpinc-socio-analytics-dialog';\n\tconst idAccept = args['id_accept'] ?? 'wpinc-socio-analytics-accept';\n\tconst idReject = args['id_reject'] ?? 'wpinc-socio-analytics-reject';\n\n\tinitTag(tagId);\n\n\tonLoad(() => {\n\t\tconst dlg = document.getElementById(idDialog) ?? createDialog(idDialog, idAccept, idReject);\n\t\tdlg.setAttribute('hidden', '');\n\n\t\tconst cfm = getState(LS_KEY, tagId, limitDay);\n\t\tif (null !== cfm) {\n\t\t\tif (CFM_OK === cfm) {\n\t\t\t\tsetEnabled();\n\t\t\t}\n\t\t} else {\n\t\t\tdlg.removeAttribute('hidden');\n\t\t\tconst okBtn = document.getElementById(idAccept);\n\t\t\tconst noBtn = document.getElementById(idReject);\n\n\t\t\tif (okBtn) {\n\t\t\t\tokBtn.addEventListener('click', () => {\n\t\t\t\t\tdlg.setAttribute('hidden', '');\n\t\t\t\t\tsetState(LS_KEY, tagId, CFM_OK);\n\t\t\t\t\tsetEnabled();\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (noBtn) {\n\t\t\t\tnoBtn.addEventListener('click', () => {\n\t\t\t\t\tdlg.setAttribute('hidden', '');\n\t\t\t\t\tsetState(LS_KEY, tagId, CFM_NO);\n\t\t\t\t\tremoveCookie();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction onLoad(fn) {\n\t\tif ('loading' === document.readyState) {\n\t\t\tdocument.addEventListener('DOMContentLoaded', fn);\n\t\t} else {\n\t\t\tsetTimeout(fn, 0);\n\t\t}\n\t}\n\n\tfunction createDialog(idDialog, idAccept, idReject) {\n\t\tconst dlg = document.createElement('div');\n\t\tdlg.setAttribute('id', idDialog);\n\t\tdlg.setAttribute('hidden', '');\n\t\tdlg.setAttribute('style', `position:fixed;inset:auto 1rem 1rem 1rem;z-index:99999;padding:1rem;background-color:#fff;box-shadow:0 0.25rem 0.5rem #0009;border-radius:0.5rem;`)\n\t\tdlg.innerHTML =\n\t\t\t`<div>\n\t\t\t\t<p>We use cookies to improve our website for users' usability and experience.</p>\n\t\t\t\t<p>To accept cookies, click 'Accept'.</p>\n\t\t\t</div>\n\t\t\t<div style=\"margin-top:1rem;text-align:right;\">\n\t\t\t\t<button id=\"${idAccept}\">Accept</button>&nbsp;\n\t\t\t\t<button id=\"${idReject}\">Reject</button>\n\t\t\t</div>`;\n\t\tdocument.body.appendChild(dlg);\n\t\treturn dlg;\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction getState(lsKey, tagId, limitDay) {\n\t\tconst day = (1000 * 60 * 60 * 24);\n\t\tconst it  = localStorage.getItem(lsKey);\n\t\ttry {\n\t\t\tconst jd = JSON.parse(it);\n\t\t\tif (jd) {\n\t\t\t\tconst r   = jd[tagId] ?? {};\n\t\t\t\tconst cfm = r['cfm'] ?? null;\n\t\t\t\tconst utc = r['utc'] ?? null;\n\t\t\t\tif (cfm && utc && Date.now() - utc < limitDay * day) {\n\t\t\t\t\treturn cfm;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t}\n\t\treturn null;\n\t}\n\n\tfunction setState(lsKey, tagId, cfm) {\n\t\tconst it = localStorage.getItem(lsKey);\n\n\t\tlet jd = null;\n\t\ttry {\n\t\t\tjd = JSON.parse(it);\n\t\t} catch (e) {\n\t\t}\n\t\tif (!jd) jd = {};\n\n\t\tif (null === cfm) {\n\t\t\tdelete jd[tagId];\n\t\t\tif (Object.keys(jd).length) {\n\t\t\t\tlocalStorage.setItem(lsKey, JSON.stringify(jd));\n\t\t\t} else {\n\t\t\t\tlocalStorage.removeItem(lsKey);\n\t\t\t}\n\t\t} else {\n\t\t\tjd[tagId] = { cfm, utc: Date.now() };\n\t\t\tlocalStorage.setItem(lsKey, JSON.stringify(jd));\n\t\t}\n\t}\n\n\n\t// -------------------------------------------------------------------------\n\n\n\tfunction initTag(tagId) {\n\t\twindow.dataLayer = window.dataLayer || [];\n\t\tfunction gtag() { window.dataLayer.push(arguments); }\n\t\tgtag('consent', 'default', { analytics_storage: 'denied' });\n\t\tgtag('consent', 'default', { ad_storage: 'denied' });\n\t\tgtag('set', 'ads_data_redaction', true);\n\t\tgtag('js', new Date());\n\t\tgtag('config', tagId);\n\t}\n\n\tfunction setEnabled() {\n\t\tfunction gtag() { window.dataLayer.push(arguments); }\n\t\tgtag('consent', 'update', { analytics_storage: 'granted' });\n\t}\n\n\tfunction removeCookie() {\n\t\tlet domain = location.hostname;\n\t\twhile (true) {\n\t\t\tconst orig = document.cookie;\n\t\t\tconst cs   = orig.split(';')\n\t\t\tfor (const c of cs) {\n\t\t\t\tconst p = c.indexOf('=')\n\t\t\t\tconst n = (-1 < p) ? c.substring(0, p).trim() : c.trim();\n\t\t\t\tif ('_ga' === n || '_gid' === n || n.startsWith('_ga_')) {\n\t\t\t\t\tdocument.cookie = `${n}=;max-age=0;domain=${domain}`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (orig !== document.cookie) break;\n\t\t\tconst p = domain.indexOf('.');\n\t\t\tif (-1 === p) break;\n\t\t\tdomain = domain.substring(p + 1);\n\t\t}\n\t}\n}\n"]}